spring:
  application:
    name: InkFlow
  datasource:
    url: ${SPRING_DATASOURCE_URL:jdbc:postgresql://localhost:5432/inkflow}
    username: ${SPRING_DATASOURCE_USERNAME:inkflow}
    password: ${SPRING_DATASOURCE_PASSWORD:inkflow_pw}
  flyway:
    enabled: true
    locations: classpath:db/migration
  data:
    mongodb:
      uri: ${SPRING_DATA_MONGODB_URI:mongodb://localhost:27017/inkflow}
    redis:
      host: ${SPRING_DATA_REDIS_HOST:localhost}
      port: ${SPRING_DATA_REDIS_PORT:6379}
  kafka:
    bootstrap-servers: ${SPRING_KAFKA_BOOTSTRAP_SERVERS:localhost:9092}
    client-id: ${SPRING_KAFKA_CLIENT_ID:inkflow-local}
    admin:
      auto-create: true
    consumer:
      key-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      value-deserializer: org.apache.kafka.common.serialization.StringDeserializer
      auto-offset-reset: earliest
    producer:
      acks: all
      retries: 3
      key-serializer: org.apache.kafka.common.serialization.StringSerializer
      value-serializer: org.apache.kafka.common.serialization.StringSerializer
      properties:
        enable.idempotence: true

inkflow:
  kafka:
    enabled: ${INKFLOW_KAFKA_ENABLED:true}
    replication-factor: ${INKFLOW_KAFKA_REPLICATION_FACTOR:1}
    topics:
      asset-events: ${INKFLOW_KAFKA_TOPIC_ASSET_EVENTS:asset.events}
      workflow-events: ${INKFLOW_KAFKA_TOPIC_WORKFLOW_EVENTS:workflow.events}
      media-jobs: ${INKFLOW_KAFKA_TOPIC_MEDIA_JOBS:media.jobs}
      media-results: ${INKFLOW_KAFKA_TOPIC_MEDIA_RESULTS:media.results}
      index-events: ${INKFLOW_KAFKA_TOPIC_INDEX_EVENTS:index.events}
      dlq-prefix: ${INKFLOW_KAFKA_TOPIC_DLQ_PREFIX:dlq}
    partitions:
      asset-events: ${INKFLOW_KAFKA_PARTITIONS_ASSET_EVENTS:3}
      workflow-events: ${INKFLOW_KAFKA_PARTITIONS_WORKFLOW_EVENTS:3}
      media-jobs: ${INKFLOW_KAFKA_PARTITIONS_MEDIA_JOBS:6}
      media-results: ${INKFLOW_KAFKA_PARTITIONS_MEDIA_RESULTS:3}
      index-events: ${INKFLOW_KAFKA_PARTITIONS_INDEX_EVENTS:3}
      dlq: ${INKFLOW_KAFKA_PARTITIONS_DLQ:1}
  outbox:
    relay:
      enabled: ${INKFLOW_OUTBOX_RELAY_ENABLED:true}
      batch-size: ${INKFLOW_OUTBOX_RELAY_BATCH_SIZE:100}
      fixed-delay: ${INKFLOW_OUTBOX_RELAY_FIXED_DELAY:2s}
      initial-delay: ${INKFLOW_OUTBOX_RELAY_INITIAL_DELAY:1s}
      lock-timeout: ${INKFLOW_OUTBOX_RELAY_LOCK_TIMEOUT:1m}
      max-retries: ${INKFLOW_OUTBOX_RELAY_MAX_RETRIES:5}
      retry-initial-delay: ${INKFLOW_OUTBOX_RELAY_RETRY_INITIAL_DELAY:2s}
      retry-max-delay: ${INKFLOW_OUTBOX_RELAY_RETRY_MAX_DELAY:1m}
      retry-multiplier: ${INKFLOW_OUTBOX_RELAY_RETRY_MULTIPLIER:2.0}
      retry-jitter-ratio: ${INKFLOW_OUTBOX_RELAY_RETRY_JITTER_RATIO:0.2}
  upload:
    session:
      ttl: ${INKFLOW_UPLOAD_SESSION_TTL:30m}
      min-chunk-size: ${INKFLOW_UPLOAD_MIN_CHUNK_SIZE:5242880}
      max-part-count: ${INKFLOW_UPLOAD_MAX_PART_COUNT:10000}
      storage-bucket: ${INKFLOW_UPLOAD_BUCKET:inkflow-uploads}
      storage-key-prefix: ${INKFLOW_UPLOAD_KEY_PREFIX:uploads/}
      redis:
        key-prefix: ${INKFLOW_UPLOAD_SESSION_KEY_PREFIX:upload:session:}
    validation:
      min-file-size: ${INKFLOW_UPLOAD_MIN_FILE_SIZE:1}
      max-file-size: ${INKFLOW_UPLOAD_MAX_FILE_SIZE:5368709120}
      allowed-extensions: ${INKFLOW_UPLOAD_ALLOWED_EXTENSIONS:jpg,jpeg,png,gif,webp,mp4,mov,pdf,epub}
    presign:
      base-url: ${INKFLOW_UPLOAD_PRESIGN_BASE_URL:http://localhost:9000}
    download:
      ttl: ${INKFLOW_UPLOAD_DOWNLOAD_TTL:10m}
    idempotency:
      ttl: ${INKFLOW_UPLOAD_IDEMPOTENCY_TTL:1h}
      redis:
        key-prefix: ${INKFLOW_UPLOAD_IDEMPOTENCY_KEY_PREFIX:upload:idempotency:}
  media:
    storage:
      endpoint: ${INKFLOW_MEDIA_STORAGE_ENDPOINT:http://localhost:9000}
      access-key: ${INKFLOW_MEDIA_STORAGE_ACCESS_KEY:inkflow}
      secret-key: ${INKFLOW_MEDIA_STORAGE_SECRET_KEY:inkflow_pw}
      region: ${INKFLOW_MEDIA_STORAGE_REGION:}
    thumbnail:
      storage-bucket: ${INKFLOW_MEDIA_THUMBNAIL_BUCKET:}
      storage-key-prefix: ${INKFLOW_MEDIA_THUMBNAIL_KEY_PREFIX:derivatives/thumbnails/}
      jpeg-quality: ${INKFLOW_MEDIA_THUMBNAIL_JPEG_QUALITY:0.85}
      background-color: ${INKFLOW_MEDIA_THUMBNAIL_BACKGROUND_COLOR:#FFFFFF}
      allowed-formats: ${INKFLOW_MEDIA_THUMBNAIL_ALLOWED_FORMATS:jpg,jpeg,png}
  indexing:
    enabled: ${INKFLOW_INDEXING_ENABLED:true}
    base-url: ${INKFLOW_INDEXING_BASE_URL:http://localhost:9200}
    indices:
      works: ${INKFLOW_INDEXING_WORKS_INDEX:works_write}
      episodes: ${INKFLOW_INDEXING_EPISODES_INDEX:episodes_write}
      assets: ${INKFLOW_INDEXING_ASSETS_INDEX:assets_write}
